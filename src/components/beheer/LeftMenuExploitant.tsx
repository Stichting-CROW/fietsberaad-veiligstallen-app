// LeftMenuExploitant.tsx
import React from 'react';
import Link from 'next/link';

import { type VSUserSecurityProfile, VSSecurityTopic } from '~/types/securityprofile';
import { VSMenuTopic } from '~/types/';
import { VSUserRoleValuesNew } from '~/types/users';

import { userHasRight, userHasRole } from '~/types/utils';
interface LeftMenuExploitantProps {
  securityProfile?: VSUserSecurityProfile;
  activecomponent: VSMenuTopic | undefined;
  onSelect: (component: VSMenuTopic) => void;
}

import { LeftMenuItem } from './LeftMenuCommon';

const LeftMenuExploitant: React.FC<LeftMenuExploitantProps> = ({
  securityProfile,
  activecomponent,
  onSelect,
}) => {
  // Do only show reports? Temporary for testing, 2025-05
  const doOnlyShowReports = (): boolean => {
    return false;//!['veiligstallen.work', 'localhost:3000'].includes(window?.location?.host||'');
  }

  const renderUnifiedMenu = () => {
    // Base conditions from user security profile

    // Role-based conditions
    const isAdmin = userHasRole(securityProfile, VSUserRoleValuesNew.RootAdmin) || userHasRole(securityProfile, VSUserRoleValuesNew.Admin);

    // Security rights using exact VSSecurityTopic enum values
    const hasFietsberaadSuperadmin = userHasRight(securityProfile, VSSecurityTopic.fietsberaad_superadmin);
    const hasFietsberaadAdmin = userHasRight(securityProfile, VSSecurityTopic.fietsberaad_admin);
    const hasExploitantenToegangsrecht = userHasRight(securityProfile, VSSecurityTopic.exploitanten_toegangsrecht);
    const hasGebruikersDataeigenaarAdmin = userHasRight(securityProfile, VSSecurityTopic.gebruikers_dataeigenaar_admin);
    const hasGebruikersDataeigenaarBeperkt = userHasRight(securityProfile, VSSecurityTopic.gebruikers_dataeigenaar_beperkt);
    const hasInstellingenDataeigenaar = userHasRight(securityProfile, VSSecurityTopic.instellingen_dataeigenaar);
    const hasInstellingenSiteContent = userHasRight(securityProfile, VSSecurityTopic.instellingen_site_content);
    const hasInstellingenFietsenstallingenAdmin = userHasRight(securityProfile, VSSecurityTopic.instellingen_fietsenstallingen_admin);
    const hasInstellingenFietsenstallingenBeperkt = userHasRight(securityProfile, VSSecurityTopic.instellingen_fietsenstallingen_beperkt);
    const hasRapportages = userHasRight(securityProfile, VSSecurityTopic.rapportages);

    return (
      <>
        <LeftMenuItem component={VSMenuTopic.Home} title={'Home'} activecomponent={activecomponent} onSelect={onSelect} />

        {doOnlyShowReports() && <>
          <LeftMenuItem component={VSMenuTopic.Report} title={'Rapportages'} compact={true} activecomponent={activecomponent} onSelect={onSelect} />
        </>}

        {! doOnlyShowReports() && <>
          { isAdmin && <LeftMenuItem component={VSMenuTopic.SettingsExploitant} title={'Instellingen'} activecomponent={activecomponent} onSelect={onSelect} />}
          { isAdmin && <LeftMenuItem component={VSMenuTopic.UsersGebruikersbeheerExploitant} title={'Gebruikers'} activecomponent={activecomponent} onSelect={onSelect} />}
        </>}
      </>
    )
  }
  
  // for now, only show the temporary production menu in production
  // const isProduction = process.env.NODE_ENV === 'production';
  // if(isProduction) {
  //   return (
  //     <ul id="leftMenu" className="shadow w-64 min-h-screen p-4">
  //       {formatLi(VSMenuTopic.Report, 'Rapportages', true)}
  //     </ul>
  //   )
  // }
  
  return (
    <ul id="leftMenu" className="shadow w-64 min-h-screen p-4">
      {renderUnifiedMenu()}
    </ul>
  );
}

export default LeftMenuExploitant;
